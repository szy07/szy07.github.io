<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦æ±‰å¤§å­¦ä¿¡æ¯é—¨æˆ· - ç™»å½•æ³¨å†Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .whu-blue { background-color: #1e3a8a; }
        .whu-light-blue { background-color: #3b82f6; }
        .whu-gold { color: #d4af37; }
        .bg-whu-pattern { 
            background: linear-gradient(rgba(30, 58, 138, 0.8), rgba(30, 58, 138, 0.9)), 
                        url('https://www.whu.edu.cn/__local/B/0B/98/E6C7F0A8F6A6D6D4F6A2F3F3F3F3F3F3F3F3F3F3.jpg') no-repeat center center;
            background-size: cover;
        }
        .admin-panel {
            display: none;
        }
        .user-dashboard {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- å¯¼èˆªæ  -->
    <nav class="whu-blue text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="h-10 w-10 rounded-full bg-white flex items-center justify-center">
                    <span class="text-blue-800 font-bold">æ­¦</span>
                </div>
                <span class="text-xl font-bold">æ­¦æ±‰å¤§å­¦ä¿¡æ¯é—¨æˆ·</span>
            </div>
            <div class="space-x-4">
                <a href="#" class="hover:text-whu-gold" id="nav-home">é¦–é¡µ</a>
                <a href="#login" class="hover:text-whu-gold" id="nav-login">ç™»å½•</a>
                <a href="#register" class="hover:text-whu-gold" id="nav-register">æ³¨å†Œ</a>
                <a href="#" class="hover:text-whu-gold hidden" id="nav-dashboard">ä»ªè¡¨æ¿</a>
                <a href="#" class="hover:text-whu-gold hidden" id="nav-admin">ç®¡ç†åå°</a>
                <a href="#" class="hover:text-whu-gold hidden" id="nav-logout">é€€å‡º</a>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container mx-auto px-4 py-8">
        <!-- æ­¦å¤§ç®€ä»‹ -->
        <section class="mb-12" id="home-section">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">æ¬¢è¿æ¥åˆ°æ­¦æ±‰å¤§å­¦ä¿¡æ¯é—¨æˆ·</h1>
                <div class="flex flex-col md:flex-row items-center">
                    <div class="md:w-1/2 mb-6 md:mb-0">
                        <p class="text-gray-700 mb-4">
                            æ­¦æ±‰å¤§å­¦æ˜¯å›½å®¶æ•™è‚²éƒ¨ç›´å±é‡ç‚¹ç»¼åˆæ€§å¤§å­¦ï¼Œæ˜¯å›½å®¶"985å·¥ç¨‹"å’Œ"211å·¥ç¨‹"é‡ç‚¹å»ºè®¾é«˜æ ¡ï¼Œæ˜¯é¦–æ‰¹"åŒä¸€æµ"å»ºè®¾é«˜æ ¡ã€‚
                        </p>
                        <p class="text-gray-700 mb-4">
                            å­¦æ ¡æº¯æºäº1893å¹´æ¸…æœ«æ¹–å¹¿æ€»ç£å¼ ä¹‹æ´å¥è¯·æ¸…æ”¿åºœåˆ›åŠçš„è‡ªå¼ºå­¦å ‚ï¼Œå†ç»ä¼ æ‰¿æ¼”å˜ï¼Œ1928å¹´å®šåä¸ºå›½ç«‹æ­¦æ±‰å¤§å­¦ï¼Œæ˜¯è¿‘ä»£ä¸­å›½ç¬¬ä¸€æ‰¹å›½ç«‹å¤§å­¦ã€‚
                        </p>
                        <p class="text-gray-700">
                            æ­¦æ±‰å¤§å­¦ç¯ç»•ä¸œæ¹–æ°´ï¼Œåæ‹¥ççˆå±±ï¼Œæ ¡å›­ç¯å¢ƒä¼˜ç¾ï¼Œé£æ™¯å¦‚ç”»ï¼Œè¢«èª‰ä¸º"ä¸­å›½æœ€ç¾ä¸½çš„å¤§å­¦"ã€‚
                        </p>
                    </div>
                    <div class="md:w-1/2 flex justify-center">
                        <div class="bg-gray-200 h-64 w-64 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500">æ­¦æ±‰å¤§å­¦æ ¡å›­é£æ™¯å›¾</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç™»å½•æ³¨å†ŒåŒºåŸŸ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="auth-section">
            <!-- ç™»å½•è¡¨å• -->
            <div id="login" class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ç”¨æˆ·ç™»å½•</h2>
                
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="loginEmail" class="block text-gray-700 text-sm font-bold mb-2">é‚®ç®±åœ°å€</label>
                        <input type="email" id="loginEmail" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    
                    <div class="mb-6">
                        <label for="loginPassword" class="block text-gray-700 text-sm font-bold mb-2">å¯†ç </label>
                        <input type="password" id="loginPassword" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                    
                    <button type="submit" 
                            class="w-full whu-blue text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 font-semibold">
                        ç™»å½•
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <button id="showTestAccount" class="text-sm text-blue-600 hover:underline">æ˜¾ç¤ºæµ‹è¯•è´¦å·</button>
                    <p id="testAccountInfo" class="text-sm text-gray-600 hidden mt-2">æµ‹è¯•è´¦å·: admin@whu.edu.cn / admin123</p>
                </div>
                
                <div class="mt-6">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">å…¶ä»–ç™»å½•æ–¹å¼</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-2 gap-2">
                        <button type="button" onclick="signInWithGitHub()"
                                class="flex justify-center items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition duration-300">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"/>
                            </svg>
                            GitHub
                        </button>
                        
                        <button type="button"
                                class="flex justify-center items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition duration-300">
                            <svg class="w-5 h-5 mr-2 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm0 18.75c-4.823 0-8.75-3.927-8.75-8.75S5.177 1.25 10 1.25 18.75 5.177 18.75 10 14.823 18.75 10 18.75z"/>
                                <path d="M13.125 10c0 .863-.512 1.607-1.25 1.947v3.553h-1.25v-3.553a2.5 2.5 0 01-1.25-2.197c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5z"/>
                            </svg>
                            å¾®ä¿¡
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div id="register" class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ç”¨æˆ·æ³¨å†Œ</h2>
                
                <form id="registerForm">
                    <div class="mb-4">
                        <label for="registerEmail" class="block text-gray-700 text-sm font-bold mb-2">é‚®ç®±åœ°å€</label>
                        <input type="email" id="registerEmail" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    
                    <div class="mb-4">
                        <label for="registerPassword" class="block text-gray-700 text-sm font-bold mb-2">å¯†ç </label>
                        <input type="password" id="registerPassword" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰">
                    </div>
                    
                    <div class="mb-4">
                        <label for="confirmPassword" class="block text-gray-700 text-sm font-bold mb-2">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="confirmPassword" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                    </div>
                    
                    <div class="mb-4">
                        <label for="fullName" class="block text-gray-700 text-sm font-bold mb-2">å§“å</label>
                        <input type="text" id="fullName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥çœŸå®å§“å">
                    </div>
                    
                    <div class="mb-6">
                        <label for="studentId" class="block text-gray-700 text-sm font-bold mb-2">å­¦å·/å·¥å·</label>
                        <input type="text" id="studentId" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="è¯·è¾“å…¥å­¦å·æˆ–å·¥å·">
                    </div>
                    
                    <button type="submit" 
                            class="w-full whu-blue text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 font-semibold">
                        æ³¨å†Œ
                    </button>
                </form>
                
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">å·²æœ‰è´¦å·ï¼Ÿ<a href="#login" class="text-blue-600 hover:underline">ç«‹å³ç™»å½•</a></p>
                </div>
            </div>
        </div>
        
        <!-- ç”¨æˆ·ä»ªè¡¨æ¿ -->
        <div id="user-dashboard" class="user-dashboard bg-white rounded-lg shadow-md p-6 mt-8">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ç”¨æˆ·ä»ªè¡¨æ¿</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">ä¸ªäººä¿¡æ¯</h3>
                    <p id="user-info" class="text-gray-700">åŠ è½½ä¸­...</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">æ ¡å›­æœåŠ¡</h3>
                    <ul class="text-gray-700">
                        <li class="mb-1">â€¢ é€‰è¯¾ç³»ç»Ÿ</li>
                        <li class="mb-1">â€¢ æˆç»©æŸ¥è¯¢</li>
                        <li class="mb-1">â€¢ å›¾ä¹¦é¦†</li>
                        <li>â€¢ æ ¡å›­å¡æœåŠ¡</li>
                    </ul>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">é€šçŸ¥å…¬å‘Š</h3>
                    <p class="text-gray-700">æš‚æ— æ–°é€šçŸ¥</p>
                </div>
            </div>
        </div>
        
        <!-- ç®¡ç†å‘˜åå° -->
        <div id="admin-panel" class="admin-panel bg-white rounded-lg shadow-md p-6 mt-8">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">ç®¡ç†å‘˜åå°</h2>
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-4">ç”¨æˆ·ç®¡ç†</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="whu-blue text-white">
                                <th class="py-2 px-4">ID</th>
                                <th class="py-2 px-4">é‚®ç®±</th>
                                <th class="py-2 px-4">å§“å</th>
                                <th class="py-2 px-4">å­¦å·/å·¥å·</th>
                                <th class="py-2 px-4">è§’è‰²</th>
                                <th class="py-2 px-4">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <tr>
                                <td colspan="6" class="text-center py-4">åŠ è½½ç”¨æˆ·æ•°æ®ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-blue-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">ç³»ç»Ÿç»Ÿè®¡</h3>
                    <ul class="text-gray-700">
                        <li class="mb-1">â€¢ æ³¨å†Œç”¨æˆ·: <span id="user-count">0</span></li>
                        <li class="mb-1">â€¢ ç®¡ç†å‘˜: <span id="admin-count">0</span></li>
                        <li>â€¢ ä»Šæ—¥ç™»å½•: <span id="login-today">0</span></li>
                    </ul>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold mb-2">ç³»ç»Ÿç®¡ç†</h3>
                    <div class="space-y-2">
                        <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">å¤‡ä»½æ•°æ®åº“</button>
                        <button class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">å‘é€ç³»ç»Ÿé€šçŸ¥</button>
                        <button class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700">æ¸…é™¤ç¼“å­˜</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½å±•ç¤º -->
        <section class="mt-12" id="features-section">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">å¹³å°åŠŸèƒ½</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="whu-blue w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">ğŸ”</span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">ç»Ÿä¸€èº«ä»½è®¤è¯</h3>
                    <p class="text-gray-600">å®‰å…¨å¯é çš„ç»Ÿä¸€èº«ä»½è®¤è¯ç³»ç»Ÿï¼Œä¸€è´¦å·é€šè¡Œæ‰€æœ‰æ ¡å›­æœåŠ¡</p>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="whu-blue w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">ğŸ“Š</span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">ä¸ªäººä¿¡æ¯ç®¡ç†</h3>
                    <p class="text-gray-600">å®Œå–„çš„ä¸ªäººä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œéšæ—¶æŸ¥çœ‹å’Œæ›´æ–°ä¸ªäººèµ„æ–™</p>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="whu-blue w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">ğŸŒ</span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">æ ¡å›­æœåŠ¡é›†æˆ</h3>
                    <p class="text-gray-600">ä¸€ç«™å¼æ ¡å›­æœåŠ¡å¹³å°ï¼Œé›†æˆé€‰è¯¾ã€æˆç»©ã€å›¾ä¹¦é¦†ç­‰å„ç±»æœåŠ¡</p>
                </div>
            </div>
        </section>
    </div>

    <!-- é¡µè„š -->
    <footer class="whu-blue text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <div class="h-8 w-8 rounded-full bg-white flex items-center justify-center">
                            <span class="text-blue-800 font-bold text-sm">æ­¦</span>
                        </div>
                        <span class="text-lg font-bold">æ­¦æ±‰å¤§å­¦ä¿¡æ¯é—¨æˆ·</span>
                    </div>
                    <p class="mt-2 text-sm">Â© 2023 æ­¦æ±‰å¤§å­¦ ç‰ˆæƒæ‰€æœ‰</p>
                </div>
                <div class="text-sm">
                    <p>åœ°å€ï¼šæ¹–åŒ—çœæ­¦æ±‰å¸‚ççˆå±±16å·</p>
                    <p class="mt-1">é‚®ç¼–ï¼š430072</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- æ¶ˆæ¯æç¤º -->
    <div id="message" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg hidden max-w-sm">
        <div class="flex items-center">
            <span id="messageIcon" class="mr-2"></span>
            <span id="messageText"></span>
        </div>
    </div>

    <script>
        // Supabaseé…ç½®
        const SUPABASE_URL = 'https://vkethnxciczquacvhisi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZrZXRobnhjaWN6cXVhY3ZoaXNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMzA3MTEsImV4cCI6MjA3ODcwNjcxMX0.n8gXVzcrypHjrBi6Q_fd99jv5YkLtF_PIKXO8elA__k';

        // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // å½“å‰ç”¨æˆ·çŠ¶æ€
        let currentUser = null;
        let currentUserRole = 'guest';

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(message, type = 'info') {
            const messageEl = document.getElementById('message');
            const messageText = document.getElementById('messageText');
            const messageIcon = document.getElementById('messageIcon');
            
            messageText.textContent = message;
            
            // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²å’Œå›¾æ ‡
            if (type === 'success') {
                messageEl.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg max-w-sm bg-green-100 text-green-800 border border-green-300';
                messageIcon.innerHTML = 'âœ…';
            } else if (type === 'error') {
                messageEl.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg max-w-sm bg-red-100 text-red-800 border border-red-300';
                messageIcon.innerHTML = 'âŒ';
            } else {
                messageEl.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg max-w-sm bg-blue-100 text-blue-800 border border-blue-300';
                messageIcon.innerHTML = 'â„¹ï¸';
            }
            
            messageEl.classList.remove('hidden');
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }

        // æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
        async function checkAuth() {
            const { data: { user }, error } = await supabase.auth.getUser();
            if (error) {
                console.error('æ£€æŸ¥è®¤è¯çŠ¶æ€å‡ºé”™:', error);
                return null;
            }
            
            if (user) {
                currentUser = user;
                // è·å–ç”¨æˆ·è§’è‰²
                const { data: userData, error: userError } = await supabase
                    .from('users')
                    .select('role, full_name, student_id')
                    .eq('id', user.id)
                    .single();
                    
                if (!userError && userData) {
                    currentUserRole = userData.role || 'student';
                    updateUIForUser(user.email, currentUserRole, userData.full_name);
                } else {
                    // å¦‚æœæ²¡æœ‰åœ¨usersè¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼Œé»˜è®¤ä¸ºå­¦ç”Ÿ
                    currentUserRole = 'student';
                    updateUIForUser(user.email, 'student', 'ç”¨æˆ·');
                }
            }
            
            return user;
        }

        // æ ¹æ®ç”¨æˆ·çŠ¶æ€æ›´æ–°UI
        function updateUIForUser(email, role, name) {
            // æ›´æ–°å¯¼èˆªæ 
            document.getElementById('nav-login').classList.add('hidden');
            document.getElementById('nav-register').classList.add('hidden');
            document.getElementById('nav-logout').classList.remove('hidden');
            
            if (role === 'admin') {
                document.getElementById('nav-admin').classList.remove('hidden');
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('features-section').classList.add('hidden');
                loadAdminData();
            } else {
                document.getElementById('nav-dashboard').classList.remove('hidden');
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('user-dashboard').classList.remove('hidden');
                document.getElementById('user-info').textContent = `æ¬¢è¿ï¼Œ${name} (${email})`;
            }
        }

        // åŠ è½½ç®¡ç†å‘˜æ•°æ®
        async function loadAdminData() {
            // æ¨¡æ‹ŸåŠ è½½ç”¨æˆ·æ•°æ®
            setTimeout(() => {
                document.getElementById('users-table').innerHTML = `
                    <tr>
                        <td class="py-2 px-4 border-b">1</td>
                        <td class="py-2 px-4 border-b">admin@whu.edu.cn</td>
                        <td class="py-2 px-4 border-b">ç³»ç»Ÿç®¡ç†å‘˜</td>
                        <td class="py-2 px-4 border-b">A10001</td>
                        <td class="py-2 px-4 border-b"><span class="bg-red-100 text-red-800 px-2 py-1 rounded">ç®¡ç†å‘˜</span></td>
                        <td class="py-2 px-4 border-b">
                            <button class="bg-blue-500 text-white px-2 py-1 rounded text-sm">ç¼–è¾‘</button>
                            <button class="bg-red-500 text-white px-2 py-1 rounded text-sm">åˆ é™¤</button>
                        </td>
                    </tr>
                    <tr>
                        <td class="py-2 px-4 border-b">2</td>
                        <td class="py-2 px-4 border-b">student1@whu.edu.cn</td>
                        <td class="py-2 px-4 border-b">å¼ ä¸‰</td>
                        <td class="py-2 px-4 border-b">2021301001001</td>
                        <td class="py-2 px-4 border-b"><span class="bg-green-100 text-green-800 px-2 py-1 rounded">å­¦ç”Ÿ</span></td>
                        <td class="py-2 px-4 border-b">
                            <button class="bg-blue-500 text-white px-2 py-1 rounded text-sm">ç¼–è¾‘</button>
                            <button class="bg-red-500 text-white px-2 py-1 rounded text-sm">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
                
                document.getElementById('user-count').textContent = '15';
                document.getElementById('admin-count').textContent = '2';
                document.getElementById('login-today').textContent = '8';
            }, 1000);
        }

        // é‚®ç®±å¯†ç æ³¨å†Œ
        async function signUp(email, password, userData) {
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: userData
                    }
                });

                if (error) throw error;
                
                if (data.user) {
                    // å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“
                    const { error: dbError } = await supabase
                        .from('users')
                        .insert([
                            { 
                                id: data.user.id, 
                                email: data.user.email,
                                full_name: userData.full_name,
                                student_id: userData.student_id,
                                role: email === 'admin@whu.edu.cn' ? 'admin' : 'student',
                                created_at: new Date()
                            }
                        ]);

                    if (dbError) {
                        console.error('ä¿å­˜ç”¨æˆ·ä¿¡æ¯å‡ºé”™:', dbError);
                        showMessage('æ³¨å†ŒæˆåŠŸï¼Œä½†ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ—¶å‡ºé”™', 'error');
                    } else {
                        showMessage('æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±éªŒè¯é‚®ä»¶ã€‚', 'success');
                    }
                }
                
                return { data, error: null };
            } catch (error) {
                console.error('æ³¨å†Œå‡ºé”™:', error);
                return { data: null, error };
            }
        }

        // é‚®ç®±å¯†ç ç™»å½•
        async function signIn(email, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;
                return { data, error: null };
            } catch (error) {
                console.error('ç™»å½•å‡ºé”™:', error);
                return { data: null, error };
            }
        }

        // GitHub OAuthç™»å½•
        async function signInWithGitHub() {
            const { data, error } = await supabase.auth.signInWithOAuth({
                provider: 'github',
                options: {
                    redirectTo: `${window.location.origin}/dashboard.html`
                }
            });
            
            if (error) {
                console.error('GitHubç™»å½•å‡ºé”™:', error);
                showMessage('GitHubç™»å½•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é€€å‡ºç™»å½•
        async function signOut() {
            const { error } = await supabase.auth.signOut();
            if (error) {
                console.error('é€€å‡ºç™»å½•å‡ºé”™:', error);
                showMessage('é€€å‡ºç™»å½•å¤±è´¥: ' + error.message, 'error');
            } else {
                currentUser = null;
                currentUserRole = 'guest';
                resetUI();
                showMessage('å·²æˆåŠŸé€€å‡ºç™»å½•', 'success');
            }
        }

        // é‡ç½®UIåˆ°æœªç™»å½•çŠ¶æ€
        function resetUI() {
            document.getElementById('nav-login').classList.remove('hidden');
            document.getElementById('nav-register').classList.remove('hidden');
            document.getElementById('nav-dashboard').classList.add('hidden');
            document.getElementById('nav-admin').classList.add('hidden');
            document.getElementById('nav-logout').classList.add('hidden');
            
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('user-dashboard').classList.add('hidden');
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('features-section').classList.remove('hidden');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
        }

        // ç™»å½•è¡¨å•æäº¤
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // æµ‹è¯•è´¦å·éªŒè¯
            if (email === 'admin@whu.edu.cn' && password === 'admin123') {
                showMessage('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼', 'success');
                // æ¨¡æ‹Ÿç®¡ç†å‘˜ç™»å½•
                currentUser = { email: 'admin@whu.edu.cn' };
                currentUserRole = 'admin';
                updateUIForUser('admin@whu.edu.cn', 'admin', 'ç³»ç»Ÿç®¡ç†å‘˜');
                return;
            }
            
            const { data, error } = await signIn(email, password);
            
            if (error) {
                showMessage('ç™»å½•å¤±è´¥: ' + error.message, 'error');
            } else {
                showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                // é¡µé¢ä¼šæ ¹æ®checkAuthçš„ç»“æœè‡ªåŠ¨æ›´æ–°
            }
        });

        // æ³¨å†Œè¡¨å•æäº¤
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const fullName = document.getElementById('fullName').value;
            const studentId = document.getElementById('studentId').value;
            
            // éªŒè¯å¯†ç 
            if (password.length < 6) {
                showMessage('å¯†ç é•¿åº¦è‡³å°‘6ä½', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            const { data, error } = await signUp(email, password, {
                full_name: fullName,
                student_id: studentId
            });
            
            if (error) {
                showMessage('æ³¨å†Œå¤±è´¥: ' + error.message, 'error');
            } else {
                // æ³¨å†ŒæˆåŠŸåçš„å¤„ç†å·²åœ¨signUpå‡½æ•°ä¸­å®Œæˆ
                document.getElementById('registerForm').reset();
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth().then(user => {
                if (user) {
                    console.log('ç”¨æˆ·å·²ç™»å½•:', user.email);
                }
            });
            
            // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
            
            // æ˜¾ç¤ºæµ‹è¯•è´¦å·
            document.getElementById('showTestAccount').addEventListener('click', function() {
                const testInfo = document.getElementById('testAccountInfo');
                testInfo.classList.toggle('hidden');
                this.textContent = testInfo.classList.contains('hidden') ? 'æ˜¾ç¤ºæµ‹è¯•è´¦å·' : 'éšè—æµ‹è¯•è´¦å·';
            });
            
            // å¯¼èˆªé“¾æ¥äº‹ä»¶
            document.getElementById('nav-home').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('home-section').scrollIntoView({
                    behavior: 'smooth'
                });
            });
            
            document.getElementById('nav-logout').addEventListener('click', function(e) {
                e.preventDefault();
                signOut();
            });
            
            document.getElementById('nav-dashboard').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('user-dashboard').scrollIntoView({
                    behavior: 'smooth'
                });
            });
            
            document.getElementById('nav-admin').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('admin-panel').scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
